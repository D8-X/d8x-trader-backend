version: "3.8"
services:
  api:
    image: 127.0.0.1:5555/main:latest
    ports:
      # REST API
      - ${PORT_REST:-3001}:${PORT_REST:-3001}
      # Websockets port
      - ${PORT_WEBSOCKET:-3002}:${PORT_WEBSOCKET:-3002}
    environment:
      - BROKER_KEY=${BROKER_KEY}
      - BROKER_FEE_TBPS=${BROKER_FEE_TBPS}
      - REDIS_URL=${REDIS_URL:-redis://:thisismypassword@redis:6379/0}
      - CHAIN_ID=${CHAIN_ID:-80001}
      - SDK_CONFIG_NAME=${SDK_CONFIG_NAME:-testnet}
      - CORS_ON=${CORS_ON:-FALSE}
      - PORT_REST=${PORT_REST:-3001}
      - PORT_WEBSOCKET=${PORT_WEBSOCKET:-3002}
      - CONFIG_PATH_RPC=/cfg_rpc
      - CONFIG_PATH_REFERRAL_SETTINGS=/cfg_referral
      - CONFIG_PATH_WSCFG=/cfg_wscfg
    configs:
      - cfg_rpc
      - cfg_referral
      - cfg_wscfg
    networks:
      - d8x_backend
    deploy:
      replicas: 2
networks:
  d8x_backend:
    driver: overlay
    name: d8x_backend
configs:
  cfg_rpc:
    external: true
  cfg_referral:
    external: true
  cfg_wscfg:
    external: true
